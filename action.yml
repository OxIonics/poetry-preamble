name: 'Poetry preamble'
description: Common steps for actions that want to poetry run
inputs:
  INSTALL_ARGS:
    description: "Additional args to poetry install"
    required: false
  GHA_TOKEN:
    description: >-
      The read-only shared user GitHub token for checkout private
      repositories.
    required: false

runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0
        submodules: recursive
        lfs: true

    - name: LFS checkout
      shell: bash
      run: git lfs checkout

    - name: Allow git dependencies
      if: github.event_name != 'push'
      shell: bash
      run: >-
        git config --global
        url."https://oxfordionics:${{ inputs.GHA_TOKEN }}@github.com".insteadOf
        ssh://git@github.com

    - name: Install
      shell: bash
      run: $POETRY install ${{ inputs.INSTALL_ARGS }}
